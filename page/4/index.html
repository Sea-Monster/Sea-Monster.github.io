<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="量">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="量">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="量">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/"/>





  <title>量</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">量</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Selenium使用cookie免登录示例（Python版）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Selenium使用cookie免登录示例（Python版）/" itemprop="url">Selenium使用cookie免登录示例（Python版）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-01T20:55:54+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>业务需求，爬取某网站，该网站必须登录，而登录过程中包含拖动滑块与汉字坐标验证码，其中后者我暂时无法破解，只能手动处理。如何做到登录一次后，保存cookie，下次就让Selenium读取cookie，免去我手动登录呢</p>
</blockquote>
<h1 id="安装Selenium"><a href="#安装Selenium" class="headerlink" title="安装Selenium"></a>安装Selenium</h1><p>安装依赖<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install selenium</span><br></pre></td></tr></table></figure></p>
<h1 id="下载webdriver"><a href="#下载webdriver" class="headerlink" title="下载webdriver"></a>下载webdriver</h1><p>由于我用最主流的Chrome，需要下载它的驱动：<a href="http://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="noopener">（chrome各个版本的web driver）</a>，假设我放到<code>/Users/SeaMonster/Downloads/</code>目录下<br>注：有时我们更新了Chrome浏览器后，再使用原来的chrome web driver就有可能产生各种奇怪的报错，如果发生这种情况，可以试试下载最新版的web driver替换之前用的。</p>
<h1 id="让Selenium登录一次"><a href="#让Selenium登录一次" class="headerlink" title="让Selenium登录一次"></a>让Selenium登录一次</h1><p>实例化一个Selenium的web drive（这里用的是Chrome的web drive）<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdrive</span><br><span class="line"># webdriver的路径</span><br><span class="line">browser = webdrive.Chrome(executable_path=&apos;/Users/SeaMonster/Downloads/chromedriver&apos;)</span><br><span class="line">browser.get(要请求的网址)</span><br></pre></td></tr></table></figure></p>
<p>然后，手动完成验证码校验</p>
<h1 id="获取cookie，保存到文件"><a href="#获取cookie，保存到文件" class="headerlink" title="获取cookie，保存到文件"></a>获取cookie，保存到文件</h1><p>登录完成后，可以获取到cookie了<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cookies = browser.get_cookies()</span><br></pre></td></tr></table></figure></p>
<p>我们把它以json格式保存到文件中<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line"># 假设文件路径为/Users/SeaMonster/PycharmProjects/TelecomInfo/src/crawl/json.txt</span><br><span class="line">with open(&apos;/Users/SeaMonster/PycharmProjects/TelecomInfo/src/crawl/json.txt&apos;,&apos;w&apos;) as fp:</span><br><span class="line">	json.dump(cookies,fp)</span><br></pre></td></tr></table></figure></p>
<h1 id="让Selenium读取cookie"><a href="#让Selenium读取cookie" class="headerlink" title="让Selenium读取cookie"></a>让Selenium读取cookie</h1><p>我们初始化一个webdriver，注意这时无法直接给它设置cookie，否则会报错。我们要先请求一下那个网页<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">browser = webdrive.Chrome(executable_path=&apos;/Users/SeaMonster/Downloads/chromedriver&apos;)</span><br><span class="line">browser.get(要请求的网址)</span><br></pre></td></tr></table></figure></p>
<p>这时可以给它设置cookie了<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">with open(&apos;/Users/SeaMonster/PycharmProjects/TelecomInfo/src/crawl/json.txt&apos;, &apos;r&apos;) as fp:</span><br><span class="line">	cookies = json.load(fp)</span><br><span class="line"></span><br><span class="line">for cookie in cookies:</span><br><span class="line">	driver.add_cookie(cookie)</span><br></pre></td></tr></table></figure></p>
<p>这时候再请求那个网址，就可发现已登录<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">browser.get(要请求的网址)</span><br></pre></td></tr></table></figure></p>
<p>参考文章：<br><a href="https://www.cnblogs.com/small-bud/p/9064674.html" target="_blank" rel="noopener">selenium+requests进行cookies保存读取操作</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/30/Mac系统下多网卡同时访问/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/30/Mac系统下多网卡同时访问/" itemprop="url">Mac系统下多网卡同时访问</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-30T10:52:53+08:00">
                2018-05-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>背景：MacBook笔记本在某工作环境，通过Wifi访问外网，通过有线网络访问内网，在不做任何设置的情况下，要上外网就只能拔掉网线，无法同时上内网外网，影响工作，那么有没办法同时访问内外网呢？</p>
</blockquote>
<p>答案是肯定的。我们要做的就是为系统添加路由（Route）。</p>
<h1 id="调整网络服务的顺序"><a href="#调整网络服务的顺序" class="headerlink" title="调整网络服务的顺序"></a>调整网络服务的顺序</h1><p>有线访问默认是排在Wifi访问之前的，但我们只需要访问某些特定网段（10，132，172）时用内网，其他时候用外网。那么我们需要把Wifi调整到有线之前：打开“系统偏好设置”->“网路”，点击左下角的“设定服务顺序”，调整顺序。</p>
<h1 id="添加理由"><a href="#添加理由" class="headerlink" title="添加理由"></a>添加理由</h1><h2 id="查看路由状态"><a href="#查看路由状态" class="headerlink" title="查看路由状态"></a>查看路由状态</h2><p>打开终端，输入：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -r</span><br></pre></td></tr></table></figure></p>
<p>可以看到类似下面的结果：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Routing tables</span><br><span class="line"></span><br><span class="line">Internet:</span><br><span class="line">Destination        Gateway            Flags        Refs      Use   Netif Expire</span><br><span class="line">default            1.160.136.219.broa UGSc           98        0     en0</span><br><span class="line">default            10.18.160.254      UGScI           5        0     en5</span><br><span class="line">10.18.160/24       link#4             UCS             7        0     en5</span><br><span class="line">10.18.160.52       0:f:1f:89:7:5d     UHLWIi          1        0     en5   1154</span><br><span class="line">10.18.160.88       54:ee:75:50:e4:f9  UHLWIi          1        0     en5   1195</span><br><span class="line">10.18.160.101/32   link#4             UCS             1        0     en5</span><br><span class="line">10.18.160.166      0:24:81:85:60:4e   UHLWIi          1        1     en5   1183</span><br><span class="line">10.18.160.222      6c:b:84:9:e3:cb    UHLWIi          1        2     en5   1167</span><br><span class="line">10.18.160.254/32   link#4             UCS             2        0     en5</span><br><span class="line">10.18.160.254      0:0:5e:0:1:3b      UHLWIir         6        0     en5   1122</span><br><span class="line">10.18.160.255      link#4             UHLWbI          1        9     en5</span><br><span class="line">127                localhost          UCS             1        0     lo0</span><br><span class="line">localhost          localhost          UH              3       42     lo0</span><br></pre></td></tr></table></figure></p>
<p>我们看看Netif这一列，有en0，en5，lo0，其中lo0代表是localhost，en5是有线网卡，en0是无线网卡。当然，实际上其他机器可能会不同。<br>Destination 与 Gateway：如果我们要访问某个ip（Destination），需要走哪个Gateway。default就是没有作特定设置的所有ip。可以看到，列表中有2个default（分别对应无线网络与有线网络），它们分别走不同的Gateway</p>
<h2 id="添加路由，让132和10网段走内网（有线）而不是外网（无线）"><a href="#添加路由，让132和10网段走内网（有线）而不是外网（无线）" class="headerlink" title="添加路由，让132和10网段走内网（有线）而不是外网（无线）"></a>添加路由，让132和10网段走内网（有线）而不是外网（无线）</h2><p>只需这样<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo route add -net 132.121.0.0 -netmask 255.255.0.0 10.18.160.254</span><br><span class="line">$ sudo route add -net 10.18.0.0 -netmask 255.255.0.0 10.18.160.254</span><br><span class="line">$ sudo route add -net 10.16.0.0 -netmask 255.255.0.0 10.18.160.254</span><br></pre></td></tr></table></figure></p>
<p>其中，132.121.0.0，设置为0代表“所有”，可以理解为132.121.0~255.0~255。10.18.0.0同理。10.18.160.254就是我们希望访问这些ip时走的Gateway。我们再次查看路由会看到如下结果：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Destination        Gateway            Flags        Refs      Use   Netif Expire</span><br><span class="line">default            1.160.136.219.broa UGSc          496        0     en0</span><br><span class="line">10.16/16           10.18.160.254      UGSc            1        0     en5</span><br><span class="line">10.18/16           10.18.160.254      UGSc            4        0     en5</span><br><span class="line">127                localhost          UCS             1        0     lo0</span><br><span class="line">localhost          localhost          UH             32    81962     lo0</span><br><span class="line">132.121            10.18.160.254      UGSc            2        0     en5</span><br></pre></td></tr></table></figure></p>
<p>可以看到那几个网段的ip将会走内网了</p>
<h2 id="如果我们将来想删除了这些路由，让它走默认呢"><a href="#如果我们将来想删除了这些路由，让它走默认呢" class="headerlink" title="如果我们将来想删除了这些路由，让它走默认呢"></a>如果我们将来想删除了这些路由，让它走默认呢</h2><p>只需这样<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo route delete  -net 132.121.0.0</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/28/Mac系统下：无效的服务器地址-BasicIPv6ValidationError/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/28/Mac系统下：无效的服务器地址-BasicIPv6ValidationError/" itemprop="url">Mac系统下：无效的服务器地址 BasicIPv6ValidationError</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-28T11:07:07+08:00">
                2018-05-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>背景：在某办公环境，没有wifi，只提供了网线，MacBook除了需要用到转接口，还需要进行网络设置。这个网络配置都是抄的其他人的，他们绝大部分是windows系统，而且他们的配置都是IPv4，没有配置IPv6。结果按照他们的配置却死活不成功，报“无效的服务器地址 BasicIPv6ValidationError”  </p>
<p>解决办法是<br>1)列出所有网络服务信息<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ networksetup -listallnetworkservices</span><br></pre></td></tr></table></figure></p>
<p>结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">An asterisk (*) denotes that a network service is disabled.</span><br><span class="line">USB 10/100 LAN</span><br><span class="line">Wi-Fi</span><br><span class="line">iPhone USB</span><br><span class="line">Bluetooth PAN</span><br><span class="line">Thunderbolt Bridge</span><br><span class="line">TissonVPN</span><br></pre></td></tr></table></figure></p>
<p>2)停止对应网卡的IPv6服务<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ networksetup -setv6off &quot;USB 10/100 LAN&quot;</span><br></pre></td></tr></table></figure></p>
<p>3)手动配置网卡的IP地址（地址部分自行调整，反正就是网址，掩码，网关3部分）<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ networksetup -setmanual &quot;USB 10/100 LAN&quot; 10.18.160.101 255.255.255.0 10.18.160.254</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/27/MySQL的DDL操作流程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/27/MySQL的DDL操作流程/" itemprop="url">MySQL的DDL操作流程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-27T12:06:29+08:00">
                2018-05-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>mysql在做表的ddl维护时(如添加字段)，是要锁表的，不像oracle那样只更新字典表、巨快，这是因为mysql采用中间表的方式来实现<br>ddl操作流程：</p>
<ol>
<li>对表加锁(表此时只读)</li>
<li>复制原表物理结构</li>
<li>修改表的物理结构</li>
<li>把原表数据导入中间表中，数据同步完后，锁定中间表，并删除原表</li>
<li>rename中间表为原表</li>
<li>刷新数据字典，并释放锁</li>
</ol>
<p>通过上面的过程可以了解到，表的数据量越大，这个ddl维护过程越耗时间（锁表时间越长）。</p>
<p>附表<br><a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-create-index-overview.html" title="Online DDL Overview" target="_blank" rel="noopener">官网：哪些操作会锁表</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/24/MySQL的Waiting-for-table-metadata-lock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/24/MySQL的Waiting-for-table-metadata-lock/" itemprop="url">MySQL的Waiting for table metadata lock</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-24T17:29:38+08:00">
                2018-05-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>Waiting for table metadata lock的出现<br>我的理解就是锁住整张表啦，这时候，针对表记录的更新操作将全被阻塞，甚至某些（全部？不确定）查询也会被阻塞！<br>为什么会出现这个“table metadata lock”呢？一般就是alter table操作，例如改表名，增删改列（名字，类型等），增删改索引。<br>由于在生产环境上，整表锁住影响很可能比较致命， 尤其是MySQL它对于修改表结构这种操作，一执行就无法中断，kill都kill不了，直到超过锁超时时间，除非把整个数据库停掉。而MySQL默认的超时时间<code>lock_wait_timeout</code>竟然长达1年。我们这种不是很专业的公司，连dba也很可能没有，也就很大可能按默认值创建数据库。所以，在进行alter table操作之前，必须修改锁超时阈值</li>
<li>调整锁超时阈值<br>查看锁超时时间<br><code>show variables like &#39;%timeout%&#39;;</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">connect_timeout	10</span><br><span class="line">delayed_insert_timeout	300</span><br><span class="line">innodb_flush_log_at_timeout	1</span><br><span class="line">innodb_lock_wait_timeout	50</span><br><span class="line">innodb_rollback_on_timeout	OFF</span><br><span class="line">interactive_timeout	28800</span><br><span class="line">lock_wait_timeout	1800</span><br><span class="line">net_read_timeout	30</span><br><span class="line">net_write_timeout	60</span><br><span class="line">rpl_stop_slave_timeout	31536000</span><br><span class="line">slave_net_timeout	3600</span><br><span class="line">wait_timeout	28800</span><br></pre></td></tr></table></figure>
<p>修改超时时间，单位是秒<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set session lock_wait_timeout = 1800;</span><br><span class="line">set global lock_wait_timeout = 1800;</span><br><span class="line">set lock_wait_timeout = 1800;</span><br></pre></td></tr></table></figure></p>
<p>session：对当前连接有效（注意是当前连接！例如在Navicat或者Sequel中，设置了该值，然后又新开一个窗口，设置对该新创建的窗口是无效的！）<br>global：对所有连接有效，数据库重启则失效<br>不写：默认就是session</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/22/一个Linux-Bash文件示例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/22/一个Linux-Bash文件示例/" itemprop="url">一个Linux Bash文件示例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-22T23:32:37+08:00">
                2018-05-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>故事背景大概是这样：有一台生产环境的服务器，没办法直接给它上传文件，也就是往上边部署代码非常麻烦，但幸好那台服务器可以访问外网，所以想出一个歪招，把代码上传到码云，然后在那台服务器上下载码云上的代码。</p>
<ol>
<li>创建.sh文件，假设文件名为update-source.sh<br> <code>$ touch update-source.sh</code></li>
<li>赋予执行权限<br> <code>$ chmod 777 update-source.sh</code></li>
<li>编辑文件<br> <code>$ vi update-source.sh</code></li>
<li><p>编写内容</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">rm -rf TelecomInfo</span><br><span class="line">wget https://gitee.com/Sea-Monster/repository/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line">rm -f master.zip</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行<br> <code>$ ./update-source.sh</code></p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/22/linux前后台任务的切换以及执行暂停/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/22/linux前后台任务的切换以及执行暂停/" itemprop="url">linux前后台任务的切换以及执行暂停</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-22T23:10:01+08:00">
                2018-05-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们平常运行一条命令，系统将会等待命令执行完毕才让我们进行下一步操作。</p>
<ol>
<li>这时按CTRL+Z，会把当前运行的命令暂停（而不是停止！CTRL+C才是停止）</li>
<li><p>这时候输入jobs，可以看到刚才暂停的进程（其实应该是job，不是进程pid），例如<br> <code>[1]+  Stopped                 ./a.out</code></p>
</li>
<li><p>我们可以让它在后台继续运行：bg 1</p>
</li>
<li>也可以让它在前台继续运行：fg 1</li>
<li>甚至可以把进程杀掉，让它真正终止： kill %1 （注意前边有个百分号）</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/15/Linux上同时安装Python2和Python3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/15/Linux上同时安装Python2和Python3/" itemprop="url">Linux上同时安装Python2和Python3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-15T11:35:13+08:00">
                2018-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Linux和MacOS默认都是安装了Python2的。我们如何在操作系统中继续安装Python3但不覆盖系统自带的Python2呢？</p>
</blockquote>
<p>这里的小技巧就是，下载Python3的源码之后，使用 “make altinstall”安裝而不是“make install”安装。</p>
<p>Python 的 make install 跟 make altinstall 有什么差別呢?<br>我们看下make的帮助文档：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install:         altinstall bininstall maninstall</span><br></pre></td></tr></table></figure></p>
<p>很明显 install 除了做 altinstall 还会做 bininstall , maninstall 共三个动作。<br>bininstall 就是在处理 Symbolic Link Chain 的事务, 而 maninstall 則是在产生 unversioned manual pages, 所以, 不使用 bininstall 可以避免 python install 时 update link的问题。说白了，就是这样安装不会自动创建softlink。保持python继续链接系统自带的python2。<br>所以我们的步骤如下：</p>
<h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p>假设我们要下载的是Python 3.6.5<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tar.xz</span><br></pre></td></tr></table></figure></p>
<h1 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h1><pre><code>tar xvJf Python-3.6.5.tar.xz
</code></pre><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>进入目录Python-3.6.5<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ./configure --prefix=/usr/local/python3 --with-ssl</span><br><span class="line">$ sudo make </span><br><span class="line">$ sudo make altinstall</span><br></pre></td></tr></table></figure></p>
<h1 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h1><p>python程序的执行文件：/usr/local/python3/bin/python3.6<br>python应用程序目录：/usr/local/python3/lib/python3.6<br>pip的执行文件：/usr/local/python3/bin/pip3.6</p>
<h1 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h1><p>配置文件有好几个：</p>
<ul>
<li>/etc/profile</li>
<li>/etc/bashrc</li>
<li>~/.bash_profile</li>
<li>~/.bashrc</li>
</ul>
<p>一般是修改~/.bash_profile<br>添加<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/usr/local/python3/bin</span><br></pre></td></tr></table></figure></p>
<p>让它生效，例如我修改的是~/.bash_profile<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source ~/.bash_profile</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/10/【Python】使用pymysql，pandas把mysql数据导出到excel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/10/【Python】使用pymysql，pandas把mysql数据导出到excel/" itemprop="url">【Python】使用pymysql，pandas把mysql数据导出到excel</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-10T09:48:17+08:00">
                2018-05-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="导出表结构"><a href="#导出表结构" class="headerlink" title="导出表结构"></a>导出表结构</h1><p>假设我们要导出表结构，保存到文档，需要保存的内容有表名，表说明，列名，类型，列说明，查询这些内容的sql语句如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select table_name,table_comment from information_schema.tables </span><br><span class="line">where table_schema=【schema名】 and table_type=&apos;base table’;</span><br><span class="line"></span><br><span class="line">select column_name,column_type,column_comment</span><br><span class="line">from information_schema.columns where table_schema=【schema名】</span><br><span class="line">and table_name=【表名】</span><br></pre></td></tr></table></figure></p>
<p>定义两个方法，分表获取表的资料和列的资料<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">from pymysql.cursors import Cursor</span><br><span class="line"># 数据库连接属性</span><br><span class="line">__db_config = &#123;</span><br><span class="line">    &apos;host&apos;: &apos;home_machine&apos;,</span><br><span class="line">    &apos;user&apos;: &apos;root&apos;,</span><br><span class="line">    &apos;password&apos;: &apos;password&apos;,</span><br><span class="line">    &apos;port&apos;: 3306,</span><br><span class="line">    &apos;db&apos;: &apos;telecom_info&apos;,</span><br><span class="line">    &apos;charset&apos;: &apos;utf8mb4&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def query_all_full_conn(sql_str, arg_list):</span><br><span class="line">    with pymysql.connect(**__db_config) as cur:</span><br><span class="line">        if isinstance(cur, Cursor):</span><br><span class="line">            cur.execute(sql_str, arg_list)</span><br><span class="line">            result = cur.fetchall()</span><br><span class="line">            return result</span><br><span class="line"></span><br><span class="line">def get_table_structure(table_name):</span><br><span class="line">    return query_all_full_conn(</span><br><span class="line">    &quot;select column_name,column_type,column_comment &quot; \</span><br><span class="line">    &quot;from information_schema.columns where table_schema&quot; \</span><br><span class="line">    &quot;=&apos;telecom_info&apos; and table_name=%s&quot;, [table_name])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_table_list():</span><br><span class="line">    return query_all_full_conn(</span><br><span class="line">    &quot;select table_name,table_comment from information_schema.tables &quot; \</span><br><span class="line">    &quot;where table_schema=&apos;telecom_info&apos; and table_type=&apos;base table&apos;&quot;, None)</span><br></pre></td></tr></table></figure></p>
<p>看看查出来的数据什么样：<br><code>get_table_list()</code><br>结果如下（表说明）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">((&apos;t_access_token&apos;, &apos;Access Token表&apos;),</span><br><span class="line"> (&apos;t_area&apos;, &apos;区域码表&apos;),</span><br><span class="line"> (&apos;t_area_stat&apos;, &apos;区域企业统计信息表&apos;),</span><br><span class="line"> (&apos;t_city_code&apos;, &apos;城市码表&apos;),</span><br><span class="line"> (&apos;t_comp_analy&apos;, &apos;企业分析表&apos;),</span><br><span class="line"> (&apos;t_comp_area&apos;, &apos;企业地区表&apos;),</span><br><span class="line"> (&apos;t_comp_basic&apos;, &apos;企业基础信息表&apos;),</span><br><span class="line"> (&apos;t_comp_basic_changelog&apos;, &apos;企业基础信息更改记录表&apos;),</span><br><span class="line"> (&apos;t_comp_biz&apos;, &apos;企业业务信息表&apos;),</span><br><span class="line"> (&apos;t_comp_import&apos;, &apos;企业信息导入表&apos;),</span><br><span class="line"> (&apos;t_industry&apos;, &apos;行业基础表&apos;),</span><br><span class="line"> (&apos;t_industry_stat&apos;, &apos;行业统计表&apos;),</span><br><span class="line"> (&apos;t_user&apos;, &apos;用户信息表&apos;))</span><br></pre></td></tr></table></figure></p>
<p>其中一个表的列说明会如何呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 以Access Token表为例</span><br><span class="line">get_table_structure(&apos;t_access_token&apos;)</span><br></pre></td></tr></table></figure></p>
<p>结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">((&apos;USER_ID&apos;, &apos;int(11)&apos;, &apos;用户ID&apos;),</span><br><span class="line"> (&apos;TOKEN_CODE&apos;, &apos;varchar(32)&apos;, &apos;Access Token的Code&apos;),</span><br><span class="line"> (&apos;BEGIN_TIME&apos;, &apos;timestamp&apos;, &apos;生效时间&apos;),</span><br><span class="line"> (&apos;END_TIME&apos;, &apos;timestamp&apos;, &apos;失效时间&apos;))</span><br></pre></td></tr></table></figure></p>
<h1 id="导出表数据"><a href="#导出表数据" class="headerlink" title="导出表数据"></a>导出表数据</h1><p>(1)可以用之前get_table_structure方法来组装sql语句，假设我们要导出T_CITY_CODE表的数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">structures = get_table_structure(table_name)</span><br><span class="line">structures</span><br></pre></td></tr></table></figure></p>
<p>可以看到表的各个列</p>
<pre><code>((&apos;CITY_ID&apos;, &apos;int(11)&apos;, &apos;城市ID&apos;),
 (&apos;CITY_CODE&apos;, &apos;varchar(10)&apos;, &apos;城市编码（电信）&apos;),
 (&apos;CITY_NAME&apos;, &apos;varchar(20)&apos;, &apos;城市名称&apos;))
</code></pre><p>(2)“转置”一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">structures_T = list(zip(*structures))</span><br><span class="line">structures_T</span><br></pre></td></tr></table></figure></p>
<p>可以看到结果列表中的第一个元素就是由每个列名组成的元组，第二个元素是每个列的类型组成的元组，第3个元素就是每个列的注释组成的元组</p>
<pre><code>[(&apos;CITY_ID&apos;, &apos;CITY_CODE&apos;, &apos;CITY_NAME&apos;),
 (&apos;int(11)&apos;, &apos;varchar(10)&apos;, &apos;varchar(20)&apos;),
 (&apos;城市ID&apos;, &apos;城市编码（电信）&apos;, &apos;城市名称&apos;)]
</code></pre><p>(3) 查出表数据<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 取出列名组成的列表/元组</span><br><span class="line">column_list =structures_T[0]</span><br><span class="line"># 拼接查询的SQL语句</span><br><span class="line">sql_str = &apos;select &#123;0&#125; from &#123;1&#125; order by &#123;2&#125;&apos;.format(&apos;,&apos;.join(column_list),table_name, column_list[0])</span><br><span class="line"># 查询结果</span><br><span class="line">result_data = query_all_full_conn(sql_str, None)</span><br><span class="line">result_data</span><br></pre></td></tr></table></figure></p>
<p>查询结果如下：</p>
<pre><code>((1, &apos;200&apos;, &apos;广州市&apos;),
 (2, &apos;755&apos;, &apos;深圳市&apos;),
 (3, &apos;756&apos;, &apos;珠海市&apos;),
 (4, &apos;754&apos;, &apos;汕头市&apos;),
 (5, &apos;751&apos;, &apos;韶关市&apos;),
 (6, &apos;762&apos;, &apos;河源市&apos;),
 (7, &apos;753&apos;, &apos;梅州市&apos;),
 (8, &apos;752&apos;, &apos;惠州市&apos;),
 (9, &apos;660&apos;, &apos;汕尾市&apos;),
 (10, &apos;769&apos;, &apos;东莞市&apos;),
 (11, &apos;760&apos;, &apos;中山市&apos;),
 (12, &apos;750&apos;, &apos;江门市&apos;),
 (13, &apos;757&apos;, &apos;佛山市&apos;),
 (14, &apos;662&apos;, &apos;阳江市&apos;),
 (15, &apos;759&apos;, &apos;湛江市&apos;),
 (16, &apos;668&apos;, &apos;茂名市&apos;),
 (17, &apos;758&apos;, &apos;肇庆市&apos;),
 (18, &apos;763&apos;, &apos;清远市&apos;),
 (19, &apos;768&apos;, &apos;潮州市&apos;),
 (20, &apos;663&apos;, &apos;揭阳市&apos;),
 (21, &apos;766&apos;, &apos;云浮市&apos;))
</code></pre><p>(4) 把查询结果转换为Pandas的DataFrame对象<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># DataFrame构造方法中不支持元组，只能转为列表</span><br><span class="line">df = pd.DataFrame(list(result_data))</span><br><span class="line"># 我们再为它指明列的名字（我们可以把列的注释作为列名而不是表原来的列名）</span><br><span class="line">df.columns=column_list</span><br></pre></td></tr></table></figure></p>
<p>DataFrame对象会是这个样子：</p>
<pre><code>    CITY_ID CITY_CODE CITY_NAME
0         1       200       广州市
1         2       755       深圳市
2         3       756       珠海市
3         4       754       汕头市
4         5       751       韶关市
5         6       762       河源市
6         7       753       梅州市
7         8       752       惠州市
8         9       660       汕尾市
9        10       769       东莞市
10       11       760       中山市
11       12       750       江门市
12       13       757       佛山市
13       14       662       阳江市
14       15       759       湛江市
15       16       668       茂名市
16       17       758       肇庆市
17       18       763       清远市
18       19       768       潮州市
19       20       663       揭阳市
20       21       766       云浮市
</code></pre><h1 id="保存到Excel文件"><a href="#保存到Excel文件" class="headerlink" title="保存到Excel文件"></a>保存到Excel文件</h1><p>如果我们要导出多个表的数据到同一份excel文件，每一个表放到一个sheet，而每一张表的数据我们已经分别生成一个DataFrame对象df1, df2…<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 假设有多张表（DataFrame）组成一个列表</span><br><span class="line">df_list = [df1, df2, df3, df4, df5]</span><br><span class="line"># 导出到Excel</span><br><span class="line">writer = pd.ExcelWriter(【导出目标excel文件含路径】)</span><br><span class="line">try:</span><br><span class="line">	for df in df_list:</span><br><span class="line">		# index为False，导出到excel时则不会有由0开始一直递增的那一列</span><br><span class="line">		df.to_excel(writer, 【sheet名，我们可以用表名】, index=False)</span><br><span class="line">	writer.save()</span><br><span class="line">except Exception as e:</span><br><span class="line">	print(e)</span><br><span class="line">finally:</span><br><span class="line">	writer.close()</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/07/【Python】读取excel文件，保存到MySQL数据库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sea Monster">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="量">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/07/【Python】读取excel文件，保存到MySQL数据库/" itemprop="url">【Python】读取excel文件，保存到MySQL数据库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-07T23:07:37+08:00">
                2018-05-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-使用Pandas读取Excel文件"><a href="#1-使用Pandas读取Excel文件" class="headerlink" title="1. 使用Pandas读取Excel文件"></a>1. 使用Pandas读取Excel文件</h1><pre><code>import pandas as pd
excel_file = Excel文件路径
df = pd.read_excel(excel_file)
</code></pre><p><a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_excel.html" title="read_excel方法的说明文档" target="_blank" rel="noopener">read_excel方法的说明文档</a></p>
<h1 id="2-处理数据"><a href="#2-处理数据" class="headerlink" title="2. 处理数据"></a>2. 处理数据</h1><p>假设DataFrame对象df的内容是这样的：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    ID  CITY_CODE CITY_NAME  CITY_TEL_NO</span><br><span class="line">0    1        200        广州市          20</span><br><span class="line">1    2        755        深圳市         755</span><br><span class="line">2    3        756        珠海市         756</span><br><span class="line">3    4        754        汕头市         754</span><br><span class="line">4    5        751        韶关市         751</span><br><span class="line">5    6        762        河源市         762</span><br><span class="line">6    7        753        梅州市         753</span><br><span class="line">7    8        752        惠州市         752</span><br><span class="line">8    9        660        汕尾市         660</span><br><span class="line">9   10        769        东莞市         769</span><br><span class="line">10  11        760        中山市         760</span><br><span class="line">11  12        750        江门市         750</span><br><span class="line">12  13        757        佛山市         757</span><br><span class="line">13  14        662        阳江市         662</span><br><span class="line">14  15        759        湛江市         759</span><br><span class="line">15  16        668        茂名市         668</span><br><span class="line">16  17        758        肇庆市         758</span><br><span class="line">17  18        763        清远市         763</span><br><span class="line">18  19        768        潮州市         768</span><br><span class="line">19  20        663        揭阳市         663</span><br><span class="line">20  21        766        云浮市         766</span><br></pre></td></tr></table></figure></p>
<p>我们只需要把CITY_CODE和CITY_NAME保存到数据库，我们可以这样做：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">param_list = zip([i for i in df[&apos;CITY_CODE&apos;]], </span><br><span class="line">            [i for i in df[&apos;CITY_NAME&apos;]])</span><br></pre></td></tr></table></figure></p>
<p>param_list将会是这个样子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[(200, &apos;广州市&apos;),</span><br><span class="line">(755, &apos;深圳市&apos;),</span><br><span class="line">(756, &apos;珠海市&apos;),</span><br><span class="line">(754, &apos;汕头市&apos;),</span><br><span class="line">(751, &apos;韶关市&apos;),</span><br><span class="line">(762, &apos;河源市&apos;),</span><br><span class="line">(753, &apos;梅州市&apos;),</span><br><span class="line">(752, &apos;惠州市&apos;),</span><br><span class="line">(660, &apos;汕尾市&apos;),</span><br><span class="line">(769, &apos;东莞市&apos;),</span><br><span class="line">(760, &apos;中山市&apos;),</span><br><span class="line">(750, &apos;江门市&apos;),</span><br><span class="line">(757, &apos;佛山市&apos;),</span><br><span class="line">(662, &apos;阳江市&apos;),</span><br><span class="line">(759, &apos;湛江市&apos;),</span><br><span class="line">(668, &apos;茂名市&apos;),</span><br><span class="line">(758, &apos;肇庆市&apos;),</span><br><span class="line">(763, &apos;清远市&apos;),</span><br><span class="line">(768, &apos;潮州市&apos;),</span><br><span class="line">(663, &apos;揭阳市&apos;),</span><br><span class="line">(766, &apos;云浮市&apos;)]</span><br></pre></td></tr></table></figure></p>
<h1 id="3-使用pymysql保存到数据库"><a href="#3-使用pymysql保存到数据库" class="headerlink" title="3. 使用pymysql保存到数据库"></a>3. 使用pymysql保存到数据库</h1><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">#打开数据库连接</span><br><span class="line">conn = pymysql.connect(host=&apos;home_machine&apos;,user=&apos;root&apos;,password=&apos;password&apos;,port=3306,db=&apos;telecom_info&apos;, charset=&apos;utf8mb4&apos;)</span><br><span class="line">#操作游标</span><br><span class="line">cur = conn.cursor()</span><br><span class="line">#定义sql语句</span><br><span class="line">sql=&apos;insert into t_city_code (CITY_CODE,CITY_NAME) values (%s,%s)&apos;</span><br><span class="line">#代入参数，插入sql语句</span><br><span class="line">effect_row = cur.executemany(sql, param_list)</span><br><span class="line">#提交事务</span><br><span class="line">conn.commit()</span><br><span class="line">#关闭游标，关闭连接</span><br><span class="line">cur.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Sea Monster</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">44</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sea Monster</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
